{"title":"自己设计一个游戏通用的2D摄像机累。Camera2D","uid":"c4a2291b6d9cf3b0bc908ac9d2a58ccd","slug":"Camera2D","date":"2024-06-03T16:00:00.000Z","updated":"2024-06-03T16:00:00.000Z","comments":true,"path":"api/articles/Camera2D.json","keywords":null,"cover":[],"content":"<p>在2D游戏开发中，摄像机是一个至关重要的组件，允许开发者控制玩家的视角，决定他们能看到游戏世界的哪些部分。这对于引导玩家的注意力和提供沉浸式体验非常重要，在战斗场景中聚焦于战斗区域；而在探索场景中扩大视野以展示更多的环境细节，跟随主要角色移动，确保玩家始终能够看到控制中的角色和周围的环境，将摄像机焦点对准可交互对象，用来提示玩家这些对象的存在和重要性，还可以用来实现特殊效果，如震动或动态缩放等，在下文中我们将会实现这样一个摄像机类用于自己的游戏。<br><img src=\"/ing/QiNuoTu/Camera2D/1.gif\" alt=\"ICON\"></p>\n<span id=\"more\"></span>\n<div align=\"center\">\n    <p align=\"center\">\n        <img src=\"/articles/QiNuoTu/icon.png\" alt=\"logo\" width=\"200\">\n    </p>\n    <h1>琪诺兔</h1>\n    <p>\n        <a href=\"https://space.bilibili.com/69720374\" target=\"_blank\">关注我的哔哩哔哩走进我的生活</a>\n        &nbsp;|&nbsp;\n        <a href=\"https://github.com/QiNuoTu\" target=\"_blank\">关注我的GitHub获得我的代码</a>\n    </p>\n</div>\n\n<h2 id=\"一个合格的摄像机应该具有以下功能。\"><a href=\"#一个合格的摄像机应该具有以下功能。\" class=\"headerlink\" title=\"一个合格的摄像机应该具有以下功能。\"></a>一个合格的摄像机应该具有以下功能。</h2><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki nord\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #d8dee9ff\">本人习惯已屏幕中心为基准处理数据，并且正向使用坐标，所有以下实现已本人使用舒适维主进行实现，我们来弄一些碎片吧。</span></span></code></pre></div><ul>\n<li><strong>视口控制：</strong>设置视口大小适应不同的分辨率和屏幕尺寸。<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SetCameraCenter</span><span class=\"params\">(<span class=\"type\">short</span> <span class=\"type\">int</span> Viewport_Width, <span class=\"type\">short</span> <span class=\"type\">int</span> Viewport_Height)</span> </span>&#123;</span><br><span class=\"line\">    ViewportWidth = Viewport_Width;</span><br><span class=\"line\">    ViewportHeight = Viewport_Height;</span><br><span class=\"line\">    ViewportCenterX = ViewportWidth * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">    ViewportCenterY = ViewportHeight * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><strong>焦点跟随：</strong>视点跟随焦点移动。<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SetTarget</span><span class=\"params\">(<span class=\"type\">float</span> targetX, <span class=\"type\">float</span> targetY)</span> </span>&#123;</span><br><span class=\"line\">    TargetX = targetX;</span><br><span class=\"line\">    TargetY = targetY;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SmoothMoveToPosition</span><span class=\"params\">(<span class=\"type\">float</span> smoothing = <span class=\"number\">0.5f</span>)</span> </span>&#123;</span><br><span class=\"line\">    CameraFocusX += (targetX - CameraFocusX) * smoothing;</span><br><span class=\"line\">    CameraFocusY += (targetY - CameraFocusY) * smoothing;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><strong>坐标转换：</strong>屏幕坐标与世界坐标之间转换，便于处理用户输入和游戏对象的位置。<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ScreenToWorld</span><span class=\"params\">(<span class=\"type\">float</span> screenX, <span class=\"type\">float</span> screenY, <span class=\"type\">float</span>&amp; worldX, <span class=\"type\">float</span>&amp; worldY)</span> <span class=\"type\">const</span> </span>&#123;</span><br><span class=\"line\">    worldX = CameraFocusX - (screenX - ViewportCenterX) / Zoom;</span><br><span class=\"line\">    worldY = CameraFocusY - (screenY - ViewportCenterY) / Zoom;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">WorldToScreen</span><span class=\"params\">(<span class=\"type\">float</span> worldX, <span class=\"type\">float</span> worldY, <span class=\"type\">float</span>&amp; screenX, <span class=\"type\">float</span>&amp; screenY)</span> <span class=\"type\">const</span> </span>&#123;</span><br><span class=\"line\">    screenX = ViewportCenterX + (CameraFocusX - worldX) * Zoom;</span><br><span class=\"line\">    screenY = ViewportCenterY + (CameraFocusY - worldY) * Zoom;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><strong>缩放功能：</strong>适应不同的游戏场景和提供不同的视觉体验。<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">float</span> <span class=\"title\">GetScale</span><span class=\"params\">()</span> <span class=\"type\">const</span> </span>&#123; <span class=\"keyword\">return</span> Zoom; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SetScale</span><span class=\"params\">(<span class=\"type\">float</span> zoom = <span class=\"number\">1</span>)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Zoom = zoom;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><strong>边界限制：</strong>设置移动边界，防止摄像机移动到游戏世界之外。<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SetWorldSize</span><span class=\"params\">(<span class=\"type\">float</span> Width, <span class=\"type\">float</span> Height)</span> </span>&#123;</span><br><span class=\"line\">    WorldBoundaryLeft = -Width * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">    WorldBoundaryTop = -Height * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">    WorldBoundaryRight = Width * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">    WorldBoundaryBottom = Height * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">SetWorldBoundaries</span><span class=\"params\">(<span class=\"type\">float</span> left, <span class=\"type\">float</span> top, <span class=\"type\">float</span> right, <span class=\"type\">float</span> bottom)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (left &lt; right &amp;&amp; top &lt; bottom) &#123;</span><br><span class=\"line\">        WorldBoundaryLeft = left;</span><br><span class=\"line\">        WorldBoundaryTop = top;</span><br><span class=\"line\">        WorldBoundaryRight = right;</span><br><span class=\"line\">        WorldBoundaryBottom = bottom;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ViewportCheckBoundaries</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">float</span> scaledOffsetX = ViewportCenterX / Zoom;</span><br><span class=\"line\">    <span class=\"type\">float</span> scaledOffsetY = ViewportCenterY / Zoom;</span><br><span class=\"line\">    CameraFocusX = std::<span class=\"built_in\">max</span>(WorldBoundaryLeft + scaledOffsetX, std::<span class=\"built_in\">min</span>(CameraFocusX, WorldBoundaryRight - scaledOffsetX));</span><br><span class=\"line\">    CameraFocusY = std::<span class=\"built_in\">max</span>(WorldBoundaryTop + scaledOffsetY, std::<span class=\"built_in\">min</span>(CameraFocusY, WorldBoundaryBottom - scaledOffsetY));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ViewportWidth / Zoom &gt; WorldBoundaryRight - WorldBoundaryLeft) &#123;</span><br><span class=\"line\">        CameraFocusX = (WorldBoundaryLeft + WorldBoundaryRight) * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ViewportHeight / Zoom &gt; WorldBoundaryBottom - WorldBoundaryTop) &#123;</span><br><span class=\"line\">        CameraFocusY = (WorldBoundaryTop + WorldBoundaryBottom) * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><strong>平滑过渡：</strong>避免视角突变给玩家带来不适。<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SmoothMoveToPosition</span><span class=\"params\">(<span class=\"type\">float</span> targetX, <span class=\"type\">float</span> targetY, <span class=\"type\">float</span> smoothing = <span class=\"number\">0.5f</span>)</span> </span>&#123;</span><br><span class=\"line\">    CameraFocusX += (targetX - CameraFocusX) * smoothing;</span><br><span class=\"line\">    CameraFocusY += (targetY - CameraFocusY) * smoothing;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Scale</span><span class=\"params\">(<span class=\"type\">float</span> zoom = <span class=\"number\">1</span>)</span></span>&#123;</span><br><span class=\"line\">    Zoom += zoom;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><strong>抖动效果：</strong>模拟冲击爆炸等效果来增强游戏的氛围和反馈。<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Shake</span><span class=\"params\">(<span class=\"type\">float</span> intensityX = <span class=\"number\">5.5f</span>, <span class=\"type\">float</span> intensityY = <span class=\"number\">5.5f</span>)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">disX</span><span class=\"params\">(-intensityX, intensityX)</span></span>;</span><br><span class=\"line\">    <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">disY</span><span class=\"params\">(-intensityY, intensityY)</span></span>;</span><br><span class=\"line\">    CameraFocusX += <span class=\"built_in\">disX</span>(gen);</span><br><span class=\"line\">    CameraFocusY += <span class=\"built_in\">disY</span>(gen);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ShakeCircle</span><span class=\"params\">(<span class=\"type\">float</span> intensityX = <span class=\"number\">5.5f</span>, <span class=\"type\">float</span> intensityY = <span class=\"number\">5.5f</span>)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">disX</span><span class=\"params\">(-intensityX, intensityX)</span></span>;</span><br><span class=\"line\">    <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">disY</span><span class=\"params\">(-intensityY, intensityY)</span></span>;</span><br><span class=\"line\">    <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">angle</span><span class=\"params\">(<span class=\"number\">-360.0f</span>, <span class=\"number\">360.0f</span>)</span></span>;</span><br><span class=\"line\">    <span class=\"type\">float</span> radian = <span class=\"built_in\">angle</span>(gen) / <span class=\"number\">360</span> * m_PI * <span class=\"number\">2</span>;</span><br><span class=\"line\">    CameraFocusX += <span class=\"built_in\">disX</span>(gen) * std::<span class=\"built_in\">cos</span>(radian);</span><br><span class=\"line\">    CameraFocusY += <span class=\"built_in\">disY</span>(gen) * std::<span class=\"built_in\">sin</span>(radian);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"此刻Camera2D类的所有碎片都已经获得，我们把他拼起来吧。\"><a href=\"#此刻Camera2D类的所有碎片都已经获得，我们把他拼起来吧。\" class=\"headerlink\" title=\"此刻Camera2D类的所有碎片都已经获得，我们把他拼起来吧。\"></a>此刻Camera2D类的所有碎片都已经获得，我们把他拼起来吧。</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Camera2D</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">Camera2D</span>(<span class=\"type\">float</span> Viewport_Width, <span class=\"type\">float</span> Viewport_Height,</span><br><span class=\"line\">        <span class=\"type\">float</span> World_Width, <span class=\"type\">float</span> World_Height,</span><br><span class=\"line\">        <span class=\"type\">float</span> FocusX = <span class=\"number\">0</span>, <span class=\"type\">float</span> FocusY = <span class=\"number\">0</span>) :</span><br><span class=\"line\">        <span class=\"built_in\">ViewportCenterX</span>(Viewport_Width * <span class=\"number\">0.5f</span>),</span><br><span class=\"line\">        <span class=\"built_in\">ViewportCenterY</span>(Viewport_Height * <span class=\"number\">0.5f</span>),</span><br><span class=\"line\">        <span class=\"built_in\">ViewportWidth</span>(Viewport_Width),</span><br><span class=\"line\">        <span class=\"built_in\">ViewportHeight</span>(Viewport_Height),</span><br><span class=\"line\">        <span class=\"built_in\">WorldBoundaryLeft</span>(-World_Width * <span class=\"number\">0.5</span>),</span><br><span class=\"line\">        <span class=\"built_in\">WorldBoundaryTop</span>(-World_Height * <span class=\"number\">0.5</span>),</span><br><span class=\"line\">        <span class=\"built_in\">WorldBoundaryRight</span>(World_Width * <span class=\"number\">0.5</span>),</span><br><span class=\"line\">        <span class=\"built_in\">WorldBoundaryBottom</span>(World_Height * <span class=\"number\">0.5</span>),</span><br><span class=\"line\">        <span class=\"built_in\">TargetX</span>(<span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"built_in\">TargetY</span>(<span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"built_in\">CameraFocusX</span>(FocusX),</span><br><span class=\"line\">        <span class=\"built_in\">CameraFocusY</span>(FocusY),</span><br><span class=\"line\">        <span class=\"built_in\">Zoom</span>(<span class=\"number\">1</span>)&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~<span class=\"built_in\">Camera2D</span>() = <span class=\"keyword\">default</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ScreenToWorld</span><span class=\"params\">(<span class=\"type\">float</span> screenX, <span class=\"type\">float</span> screenY, <span class=\"type\">float</span>&amp; worldX, <span class=\"type\">float</span>&amp; worldY)</span> <span class=\"type\">const</span> </span>&#123;</span><br><span class=\"line\">        worldX = CameraFocusX - (screenX - ViewportCenterX) / Zoom;</span><br><span class=\"line\">        worldY = CameraFocusY - (screenY - ViewportCenterY) / Zoom;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">WorldToScreen</span><span class=\"params\">(<span class=\"type\">float</span> worldX, <span class=\"type\">float</span> worldY, <span class=\"type\">float</span>&amp; screenX, <span class=\"type\">float</span>&amp; screenY)</span> <span class=\"type\">const</span> </span>&#123;</span><br><span class=\"line\">        screenX = ViewportCenterX + (CameraFocusX - worldX) * Zoom;</span><br><span class=\"line\">        screenY = ViewportCenterY + (CameraFocusY - worldY) * Zoom;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">float</span> <span class=\"title\">GetScale</span><span class=\"params\">()</span> <span class=\"type\">const</span> </span>&#123; <span class=\"keyword\">return</span> Zoom; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SetScale</span><span class=\"params\">(<span class=\"type\">float</span> zoom = <span class=\"number\">1</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Zoom = zoom;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Scale</span><span class=\"params\">(<span class=\"type\">float</span> zoom = <span class=\"number\">1</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Zoom += zoom;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SmoothMoveToPosition</span><span class=\"params\">(<span class=\"type\">float</span> targetX, <span class=\"type\">float</span> targetY, <span class=\"type\">float</span> smoothing = <span class=\"number\">0.5f</span>)</span> </span>&#123;</span><br><span class=\"line\">        CameraFocusX += (targetX - CameraFocusX) * smoothing;</span><br><span class=\"line\">        CameraFocusY += (targetY - CameraFocusY) * smoothing;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SetTarget</span><span class=\"params\">(<span class=\"type\">float</span> targetX, <span class=\"type\">float</span> targetY)</span> </span>&#123;</span><br><span class=\"line\">        TargetX = targetX;</span><br><span class=\"line\">        TargetY = targetY;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SmoothMoveToTarget</span><span class=\"params\">(<span class=\"type\">float</span> smoothing = <span class=\"number\">0.5f</span>)</span> </span>&#123;</span><br><span class=\"line\">        CameraFocusX += (TargetX - CameraFocusX) * smoothing;</span><br><span class=\"line\">        CameraFocusY += (TargetY - CameraFocusY) * smoothing;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Shake</span><span class=\"params\">(<span class=\"type\">float</span> intensityX = <span class=\"number\">5.5f</span>, <span class=\"type\">float</span> intensityY = <span class=\"number\">5.5f</span>)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">disX</span><span class=\"params\">(-intensityX, intensityX)</span></span>;</span><br><span class=\"line\">        <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">disY</span><span class=\"params\">(-intensityY, intensityY)</span></span>;</span><br><span class=\"line\">        CameraFocusX += <span class=\"built_in\">disX</span>(gen);</span><br><span class=\"line\">        CameraFocusY += <span class=\"built_in\">disY</span>(gen);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ShakeCircle</span><span class=\"params\">(<span class=\"type\">float</span> intensityX = <span class=\"number\">5.5f</span>, <span class=\"type\">float</span> intensityY = <span class=\"number\">5.5f</span>)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">disX</span><span class=\"params\">(-intensityX, intensityX)</span></span>;</span><br><span class=\"line\">        <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">disY</span><span class=\"params\">(-intensityY, intensityY)</span></span>;</span><br><span class=\"line\">        <span class=\"function\">std::uniform_real_distribution&lt;<span class=\"type\">float</span>&gt; <span class=\"title\">angle</span><span class=\"params\">(<span class=\"number\">-360.0f</span>, <span class=\"number\">360.0f</span>)</span></span>;</span><br><span class=\"line\">        <span class=\"type\">float</span> radian = <span class=\"built_in\">angle</span>(gen) / <span class=\"number\">360</span> * <span class=\"number\">3.1415926535</span> * <span class=\"number\">2</span>;</span><br><span class=\"line\">        CameraFocusX += <span class=\"built_in\">disX</span>(gen) * std::<span class=\"built_in\">cos</span>(radian);</span><br><span class=\"line\">        CameraFocusY += <span class=\"built_in\">disY</span>(gen) * std::<span class=\"built_in\">sin</span>(radian);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SetCameraCenter</span><span class=\"params\">(<span class=\"type\">short</span> <span class=\"type\">int</span> Viewport_Width, <span class=\"type\">short</span> <span class=\"type\">int</span> Viewport_Height)</span> </span>&#123;</span><br><span class=\"line\">        ViewportWidth = Viewport_Width;</span><br><span class=\"line\">        ViewportHeight = Viewport_Height;</span><br><span class=\"line\">        ViewportCenterX = ViewportWidth * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">        ViewportCenterY = ViewportHeight * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SetFocus</span><span class=\"params\">(<span class=\"type\">float</span> FocusX, <span class=\"type\">float</span> FocusY)</span> </span>&#123;</span><br><span class=\"line\">        CameraFocusX = FocusX;</span><br><span class=\"line\">        CameraFocusY = FocusY;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Move</span><span class=\"params\">(<span class=\"type\">float</span> deltaX, <span class=\"type\">float</span> deltaY)</span> </span>&#123;</span><br><span class=\"line\">        CameraFocusX += deltaX;</span><br><span class=\"line\">        CameraFocusY += deltaY;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">float</span> <span class=\"title\">GetFocusX</span><span class=\"params\">()</span> <span class=\"type\">const</span> </span>&#123; <span class=\"keyword\">return</span> CameraFocusX; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">float</span> <span class=\"title\">GetFocusY</span><span class=\"params\">()</span> <span class=\"type\">const</span> </span>&#123; <span class=\"keyword\">return</span> CameraFocusY; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">SetWorldSize</span><span class=\"params\">(<span class=\"type\">float</span> Width, <span class=\"type\">float</span> Height)</span> </span>&#123;</span><br><span class=\"line\">        WorldBoundaryLeft = -Width * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">        WorldBoundaryTop = -Height * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">        WorldBoundaryRight = Width * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">        WorldBoundaryBottom = Height * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">SetWorldBoundaries</span><span class=\"params\">(<span class=\"type\">float</span> left, <span class=\"type\">float</span> top, <span class=\"type\">float</span> right, <span class=\"type\">float</span> bottom)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (left &lt; right &amp;&amp; top &lt; bottom) &#123;</span><br><span class=\"line\">            WorldBoundaryLeft = left;</span><br><span class=\"line\">            WorldBoundaryTop = top;</span><br><span class=\"line\">            WorldBoundaryRight = right;</span><br><span class=\"line\">            WorldBoundaryBottom = bottom;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ViewportCheckBoundaries</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">float</span> scaledOffsetX = ViewportCenterX / Zoom;</span><br><span class=\"line\">        <span class=\"type\">float</span> scaledOffsetY = ViewportCenterY / Zoom;</span><br><span class=\"line\">        CameraFocusX = std::<span class=\"built_in\">max</span>(WorldBoundaryLeft + scaledOffsetX, std::<span class=\"built_in\">min</span>(CameraFocusX, WorldBoundaryRight - scaledOffsetX));</span><br><span class=\"line\">        CameraFocusY = std::<span class=\"built_in\">max</span>(WorldBoundaryTop + scaledOffsetY, std::<span class=\"built_in\">min</span>(CameraFocusY, WorldBoundaryBottom - scaledOffsetY));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ViewportWidth / Zoom &gt; WorldBoundaryRight - WorldBoundaryLeft) &#123;</span><br><span class=\"line\">            CameraFocusX = (WorldBoundaryLeft + WorldBoundaryRight) * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ViewportHeight / Zoom &gt; WorldBoundaryBottom - WorldBoundaryTop) &#123;</span><br><span class=\"line\">            CameraFocusY = (WorldBoundaryTop + WorldBoundaryBottom) * <span class=\"number\">0.5f</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">GetFocusRect</span><span class=\"params\">(<span class=\"type\">float</span>&amp; left, <span class=\"type\">float</span>&amp; top, <span class=\"type\">float</span>&amp; right, <span class=\"type\">float</span>&amp; bottom)</span> </span>&#123;</span><br><span class=\"line\">         left = CameraFocusX - ViewportCenterX;</span><br><span class=\"line\">         top = CameraFocusY - ViewportCenterY;</span><br><span class=\"line\">         right = CameraFocusX + ViewportCenterX;</span><br><span class=\"line\">         bottom = CameraFocusY + ViewportCenterY;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    std::random_device rd;</span><br><span class=\"line\">    <span class=\"function\">std::mt19937 <span class=\"title\">gen</span><span class=\"params\">(rd())</span></span>;</span><br><span class=\"line\">    <span class=\"type\">float</span> TargetX, TargetY;</span><br><span class=\"line\">    <span class=\"type\">float</span> CameraFocusX, CameraFocusY;</span><br><span class=\"line\">    <span class=\"type\">float</span> ViewportCenterX, ViewportCenterY, ViewportWidth, ViewportHeight;</span><br><span class=\"line\">    <span class=\"type\">float</span> Zoom, WorldBoundaryLeft, WorldBoundaryTop, WorldBoundaryRight, WorldBoundaryBottom;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"这是什么\"><a href=\"#这是什么\" class=\"headerlink\" title=\"这是什么?\"></a>这是什么?</h2><p><img src=\"/img/QiNuoTu/Camera2D/2.png\" alt=\"ICON\"></p>\n","feature":true,"text":"在2D游戏开发中，摄像机是一个至关重要的组件，允许开发者控制玩家的视角，决定他们能看到游戏世界的哪些部分。这对于引导玩家的注意力和提供沉浸式体验非常重要，在战斗...","permalink":"/post/Camera2D","photos":[],"count_time":{"symbolsCount":"9.7k","symbolsTime":"9 mins."},"categories":[{"name":"QiNuoTu","slug":"QiNuoTu","count":5,"path":"api/categories/QiNuoTu.json"}],"tags":[{"name":"教程","slug":"教程","count":2,"path":"api/tags/教程.json"},{"name":"游戏开发","slug":"游戏开发","count":3,"path":"api/tags/游戏开发.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\"><span class=\"toc-text\">琪诺兔</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E4%B8%AA%E5%90%88%E6%A0%BC%E7%9A%84%E6%91%84%E5%83%8F%E6%9C%BA%E5%BA%94%E8%AF%A5%E5%85%B7%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%8A%9F%E8%83%BD%E3%80%82\"><span class=\"toc-text\">一个合格的摄像机应该具有以下功能。</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%AD%A4%E5%88%BBCamera2D%E7%B1%BB%E7%9A%84%E6%89%80%E6%9C%89%E7%A2%8E%E7%89%87%E9%83%BD%E5%B7%B2%E7%BB%8F%E8%8E%B7%E5%BE%97%EF%BC%8C%E6%88%91%E4%BB%AC%E6%8A%8A%E4%BB%96%E6%8B%BC%E8%B5%B7%E6%9D%A5%E5%90%A7%E3%80%82\"><span class=\"toc-text\">此刻Camera2D类的所有碎片都已经获得，我们把他拼起来吧。</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%BF%99%E6%98%AF%E4%BB%80%E4%B9%88\"><span class=\"toc-text\">这是什么?</span></a></li></ol></li></ol>","author":{"name":"琪诺兔","slug":"blog-author","avatar":"/img/ChinoRabitHead.jpg","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"是琪诺兔啦！(●'◡'●)！","uid":"09ebe5c5bda45f47de8e5ceef949d407","slug":"Iamme","date":"2024-05-30T16:00:00.000Z","updated":"2024-05-30T16:00:00.000Z","comments":true,"path":"api/articles/Iamme.json","keywords":null,"cover":[],"text":"琪诺兔是一种幻想生物，他十分可爱，o( ?_? )o/ 琪诺兔 关注我的哔哩哔哩走进我的生活 | 关注我的GitHub获得我的代码 #这是什么？ ","permalink":"/post/Iamme","photos":[],"count_time":{"symbolsCount":140,"symbolsTime":"1 mins."},"categories":[{"name":"QiNuoTu","slug":"QiNuoTu","count":5,"path":"api/categories/QiNuoTu.json"}],"tags":[{"name":"闲聊","slug":"闲聊","count":1,"path":"api/tags/闲聊.json"}],"author":{"name":"琪诺兔","slug":"blog-author","avatar":"/img/ChinoRabitHead.jpg","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}